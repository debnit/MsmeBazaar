# Trivy Secret Scanning Configuration
# This file configures secret detection rules for the MSMEBazaar project

# Global settings for secret scanning
scan:
  enabled: true
  max-size: 10MB
  max-depth: 5

# Secret detection rules
rules:
  # AWS Credentials
  - id: aws-access-key
    description: "AWS Access Key ID"
    regex: "AKIA[0-9A-Z]{16}"
    keywords:
      - "AKIA"
      - "aws_access_key"
    severity: CRITICAL

  - id: aws-secret-key
    description: "AWS Secret Access Key"
    regex: "[0-9a-zA-Z/+]{40}"
    keywords:
      - "aws_secret_access_key"
      - "aws_secret"
    severity: CRITICAL

  # Database Credentials
  - id: database-url
    description: "Database Connection URL"
    regex: "(postgres|mysql|mongodb)://[^\\s]*:[^\\s]*@[^\\s]*"
    keywords:
      - "DATABASE_URL"
      - "DB_URL"
    severity: HIGH

  # API Keys
  - id: generic-api-key
    description: "Generic API Key"
    regex: "(?i)(api[_-]?key|apikey)[\\s]*[=:][\\s]*['\"]?[0-9a-zA-Z]{16,}['\"]?"
    keywords:
      - "api_key"
      - "apikey"
      - "API_KEY"
    severity: HIGH

  # JWT Tokens
  - id: jwt-token
    description: "JSON Web Token"
    regex: "eyJ[A-Za-z0-9_-]*\\.[A-Za-z0-9_-]*\\.[A-Za-z0-9_-]*"
    keywords:
      - "jwt"
      - "token"
    severity: MEDIUM

  # Private Keys
  - id: rsa-private-key
    description: "RSA Private Key"
    regex: "-----BEGIN RSA PRIVATE KEY-----"
    keywords:
      - "BEGIN RSA PRIVATE KEY"
    severity: CRITICAL

  - id: ssh-private-key
    description: "SSH Private Key"
    regex: "-----BEGIN OPENSSH PRIVATE KEY-----"
    keywords:
      - "BEGIN OPENSSH PRIVATE KEY"
    severity: CRITICAL

  # GitHub Tokens
  - id: github-token
    description: "GitHub Personal Access Token"
    regex: "ghp_[0-9a-zA-Z]{36}"
    keywords:
      - "ghp_"
      - "github_token"
    severity: HIGH

  # Slack Tokens
  - id: slack-token
    description: "Slack Token"
    regex: "xox[baprs]-[0-9a-zA-Z-]+"
    keywords:
      - "slack_token"
      - "xoxb"
      - "xoxa"
    severity: HIGH

  # Google API Keys
  - id: google-api-key
    description: "Google API Key"
    regex: "AIza[0-9A-Za-z_-]{35}"
    keywords:
      - "AIza"
      - "google_api"
    severity: HIGH

  # Generic passwords
  - id: password-in-url
    description: "Password in URL"
    regex: "://[^\\s]*:[^\\s]*@"
    keywords:
      - "password"
      - "passwd"
    severity: MEDIUM

# File patterns to include in secret scanning
include:
  - "**/*.js"
  - "**/*.ts"
  - "**/*.jsx"
  - "**/*.tsx"
  - "**/*.py"
  - "**/*.java"
  - "**/*.go"
  - "**/*.rb"
  - "**/*.php"
  - "**/*.yaml"
  - "**/*.yml"
  - "**/*.json"
  - "**/*.xml"
  - "**/*.env*"
  - "**/*.config"
  - "**/*.properties"
  - "**/Dockerfile*"
  - "**/*.sh"
  - "**/*.bash"

# File patterns to exclude from secret scanning
exclude:
  - "**/node_modules/**"
  - "**/.git/**"
  - "**/dist/**"
  - "**/build/**"
  - "**/.next/**"
  - "**/coverage/**"
  - "**/*.min.js"
  - "**/*.min.css"
  - "**/package-lock.json"
  - "**/yarn.lock"
  - "**/pnpm-lock.yaml"
  - "**/composer.lock"
  - "**/*.log"
  - "**/trivy-secret.yaml"  # Don't scan this file itself

# Paths to exclude (specific directories)
exclude-paths:
  - ".git"
  - "node_modules"
  - ".next"
  - "dist"
  - "build"
  - "coverage"
  - ".turbo"
  - "logs"

# Allow list for known false positives
allowlist:
  # Example entries (uncomment and modify as needed)
  # - description: "Test API key for development"
  #   path: "tests/fixtures/test-data.json"
  #   rule: "generic-api-key"
  #   
  # - description: "Example password in documentation"
  #   path: "docs/examples/config.md"
  #   rule: "password-in-url"

# Confidence levels
confidence:
  high: 0.8
  medium: 0.5
  low: 0.2

# Output settings
output:
  format: "sarif"
  show-suppressed: false
  max-findings: 1000

# Additional settings
settings:
  case-sensitive: false
  include-binary: false
  max-file-size: "10MB"
  timeout: "30s"